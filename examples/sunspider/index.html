<html>
<head>
<title>Benchmarking Sunspider</title>
<script type="text/javascript">

    var tests = [
            "3d-cube",
            "3d-morph",
            /*"3d-raytrace", */
            "access-binary-trees",
            "access-fannkuch",
            /* "access-nbody", */
            "access-nsieve",
            "bitops-3bit-bits-in-byte",
            "bitops-bits-in-byte",
            "bitops-bitwise-and",
            "bitops-nsieve-bits",
            "controlflow-recursive",
            "crypto-aes",
            "crypto-md5",
            "crypto-sha1",
            "date-format-tofte",
            "date-format-xparb",
            "math-cordic",
            "math-partial-sums",
            "math-spectral-norm",
            "regexp-dna",
            "string-base64",
            "string-fasta",
            /* "string-tagcloud", */
            "string-unpack-code",
            "string-validate-input"
            ];
    
    var TIMES_PER_TEST = 10;
    var currentTest;
    var numTimesRan;
    var curIframe;
    var pResults;
    
    function startTest() {
        currentTest = tests.shift();
        pResults.innerHTML = pResults.innerHTML + "<br>" + currentTest;
        numTimesRan = 0;
    }
    
    function dispatchTest() {
        if (tests.length == 0 && numTimesRan == TIMES_PER_TEST) {
            console.log("Tests Done.");
            return;
        }
        
        if (numTimesRan >= TIMES_PER_TEST) {
            startTest();
        }
        
        if (curIframe) {
            document.body.removeChild(curIframe);
        }
        
        console.log("Need to run test '" + currentTest + "' " + (TIMES_PER_TEST - numTimesRan) + " more times.");
        
        curIframe = document.createElement('iframe');
        curIframe.src = "bench.html?bench=" + currentTest + "&dummy=" + Date.now(); 
        document.body.appendChild(curIframe);
    }
    
    function receiveResult(e) {
        pResults.innerHTML = pResults.innerHTML + " " + e.data;
        numTimesRan++;
        dispatchTest();
    }
    
    function init() {
        var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
        var eventer = window[eventMethod];
        var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
        eventer(messageEvent, receiveResult, false);
        
        pResults = document.getElementById('results');
        startTest();
        curIframe = null;
        
        dispatchTest();
    }
    
    window.onload = init;
    
</script>
</head>
<body>
	<h1>Benchmarking Sunspider</h1>
	<p id="results"></p>
</body>
</html>
