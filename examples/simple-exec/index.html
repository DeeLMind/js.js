<html>
  <head>
    <script type="text/javascript" src="js.js"></script>
    <script type="text/javascript">

function start_jsjs() {

   var JSJS = {
      NewRuntime: function NewRuntime(maxbytes) {
          return _JS_Init(maxbytes);
      },
      NewContext: function NewContext(runtime, stackChunkSize) {
          return _JS_NewContext(runtime, stackChunkSize)
      },
      DestroyContext: function DestroyContext(context) {
          return _JS_DestroyContext(context);
      },
      DestroyRuntime: function DestroyRuntime(runtime) {
          return _JS_Finish(runtime);
      },
      ShutDown: function ShutDown() {
          return _JS_ShutDown();
      },
      SetOptions: function SetOptions(context, options) {
          return _JS_SetOptions(context, options);
      },
      SetVersion: function SetVersion(context, version) {
          return _JS_SetVersion(context, version);
      },
      SetErrorReporter: function SetErrorReporter(context, errorReporter) {
          return _JS_SetErrorReporter(context, errorReporter);
      },
      NewCompartmentAndGlobalObject: function NewCompartmentAndGlobalObject(context, globalClass, principals) {
          return _JS_NewCompartmentAndGlobalObject(context, globalClass, principals);
      },
      InitStandardClasses: function InitStandardClasses(context, globalClass) {
          return _JS_InitStandardClasses(context, globalClass);
      },
      EvaluateScript: function EvaluateScript(context, global, source, filename, lineno) {
          var __stackBase__  = STACKTOP; STACKTOP += 20; assert(STACKTOP < STACK_MAX, "Ran out of stack");
          var sourcePtr = allocate(intArrayFromString(source), 'i8', ALLOC_STACK);
          filename = allocate(intArrayFromString(filename ? filename : "undefined"), 'i8', ALLOC_STACK);
          lineno = lineno ? lineno : 0;
          var rval = __stackBase__ + 8;
          var returnVal = _JS_EvaluateScript(context, global, sourcePtr, source.length, filename, lineno, rval);
          STACKTOP = __stackBase__;
          return { ok: returnVal, rval: rval};

      },
   };

   // Creates a new runtime with 8MB of memory
   var rt = JSJS.NewRuntime(8*1024*1024);
   print("rt " + rt);

   var cx = JSJS.NewContext(rt, 8192);
   print("cx " + cx);

   // See documentation for explanation -- needed for most scripts
   var JSOPTION_VAROBJFIX = 1 << 2;
   JSJS.SetOptions(cx, JSOPTION_VAROBJFIX);

   // Set the version of JavaScript to 1.85
   var JSVERSION_LATEST = 185;
   JSJS.SetVersion(cx, JSVERSION_LATEST);

   // This is the default error reporter for shell/js.cpp
   JSJS.SetErrorReporter(cx, 396);

   // This creates the "global object" in the interpreter space.
   // __global_class is defined by js/shell.cpp to be a nice, sane default
   var global = JSJS.NewCompartmentAndGlobalObject(cx, _global_class, 0);
   print("global " + global);

   // Currently dying here
   JSJS.InitStandardClasses(cx, global);

   var source = "print(42);";
   var ok, rval;
   rval = JSJS.EvaluateScript(cx, global, source);

   // This is how you do a proper shut down
   JSJS.DestroyContext(cx);
   JSJS.DestroyRuntime(rt);
   JSJS.ShutDown();

}

window.onload = start_jsjs;

    </script>
  </head>
  <body>
    <h1>js.js Simple Execution Demo</h1>
    <p id="demo">Stuff Here.</p>
  </body>
</html>
