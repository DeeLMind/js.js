<html>
<head>
<title>js.js Simple Security</title>
<script type="text/javascript" src="../../src/libjs.O2.js"></script>
<script type="text/javascript" src="../../src/jsjs-wrapper.js"></script>
<script type="text/javascript">

var scriptSrc = "document.getElementById('demo').innerHTML = 'It worked'; \
  document.getElementById('demo').innerHTML = 'The meaning of life'; \
  document.getElementById('demo2').innerHTML = 'failure'; \
  document.getElementById('demo2').innerHTML = 'failure';"; 

  function start_jsjs() {
      var jsObjs = JSJS.Init();
      var ok = JSJS.InitDocument(jsObjs, 'locked');
      JSJS.UnlockElement(document.getElementById('demo'));
      
      // Everything has gone well, execute script
      rval = JSJS.EvaluateScript(jsObjs.cx, jsObjs.glob, scriptSrc);
      if (rval) {
          //Convert the JSVal to 'the right thing' 
          d = JSJS.identifyConvertValue(jsObjs.cx, rval);
      } else {
          d = "Can't get result because an error happened.";
      }
  
      // This is how you do a proper shut down
      JSJS.End(jsObjs);
  }

  function unprotected() { eval(scriptSrc); };

  </script>
</head>
<body>
    <h1>js.js Simple Security Test</h1>
    <form>
      <input type="button" value="Protected Modify Text" onclick="start_jsjs()" >
      <input type="button" value="Native Modify Text" onclick="unprotected()" >
    </form>

    <p id="demo">This should be replaced by 'The meaning of life'</p>
    <p id="demo2">This should not change, 
    and you should see an error in console</p>
</body>
</html>
