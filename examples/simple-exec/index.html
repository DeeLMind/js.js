<html>
  <head>
    <script type="text/javascript" src="js.js"></script>
    <script type="text/javascript">


   var JSJS = {
      NewRuntime: function NewRuntime(maxbytes) {
          return _JS_Init(maxbytes);
      },
      NewContext: function NewContext(runtime, stackChunkSize) {
          return _JS_NewContext(runtime, stackChunkSize)
      },
      DestroyContext: function DestroyContext(context) {
          return _JS_DestroyContext(context);
      },
      DestroyRuntime: function DestroyRuntime(runtime) {
          return _JS_Finish(runtime);
      },
      ShutDown: function ShutDown() {
          return _JS_ShutDown();
      },
      SetOptions: function SetOptions(context, options) {
          return _JS_SetOptions(context, options);
      },
      SetVersion: function SetVersion(context, version) {
          return _JS_SetVersion(context, version);
      },
      SetErrorReporter: function SetErrorReporter(context, errorReporter) {
          var funcPosition = FUNCTION_TABLE.push(errorReporter) - 1;
          return _JS_SetErrorReporter(context, funcPosition);
      },
      NewCompartmentAndGlobalObject: function NewCompartmentAndGlobalObject(context, globalClass, principals) {
          return _JS_NewCompartmentAndGlobalObject(context, globalClass, principals);
      },
      InitStandardClasses: function InitStandardClasses(context, globalClass) {
          return _JS_InitStandardClasses(context, globalClass);
      },
      EvaluateScript: function EvaluateScript(context, global, source, filename, lineno) {
          var sourcePtr = allocate(intArrayFromString(source), 'i8', ALLOC_STACK);
          filename = allocate(intArrayFromString(filename ? filename : "undefined"), 'i8', ALLOC_STACK);
          lineno = lineno ? lineno : 0;
          var rval = allocate(8, 'i8', ALLOC_NORMAL);
          var ok = _JS_EvaluateScript(context, global, sourcePtr, source.length, filename, lineno, rval);
          if (ok == 0) {
              return null;
          }
          return rval;
      },
      ValueToNumber: function ValueToNumber(context, jsval) {
          var rval = allocate(1, 'double', ALLOC_NORMAL);
          ok = _JS_ValueToNumber(context, jsval, rval);
          if (ok == 0) {
              return null;
          }
          return getValue(rval, 'double');
      },
      Init: function Init() {
           // Creates a new runtime with 8MB of memory
           var rt = JSJS.NewRuntime(8*1024*1024);
           print("rt " + rt);

           var cx = JSJS.NewContext(rt, 8192);
           print("cx " + cx);

           // See documentation for explanation -- needed for most scripts
           var JSOPTION_VAROBJFIX = 1 << 2;
           JSJS.SetOptions(cx, JSOPTION_VAROBJFIX);

           // Set the version of JavaScript to 1.85
           var JSVERSION_LATEST = 185;
           JSJS.SetVersion(cx, JSVERSION_LATEST);

           // Set a function that gets called when an error happens
           function errorReporter(cx, message, report) {
               print("ERROR: " + Pointer_stringify(message));
           }
           JSJS.SetErrorReporter(cx, errorReporter);

           // This creates the "global object" in the interpreter space.
           // __global_class is defined by js/shell.cpp to be a nice, sane default
           var global = JSJS.NewCompartmentAndGlobalObject(cx, _global_class, 0);
           print("global " + global);

           // Initializes the standard javascript global objects like Array, Date, etc
           JSJS.InitStandardClasses(cx, global);

           return {rt: rt, cx: cx, glob: global};
      },
      End: function End(jsObjs) {
         JSJS.DestroyContext(jsObjs.cx);
         JSJS.DestroyRuntime(jsObjs.rt);
         JSJS.ShutDown();
      },
      Types: {
          JSFunctionSpec: {
              makePtr: function makePtr(name, func, nargs, flags) {
                  var data = allocate([1, 1, 1, 1], ['i32', 'i32', 'i16', 'i16'], ALLOC_NORMAL);
                  var namePtr = allocate(intArrayFromString(name), 'i8', ALLOC_STACK);
                  setValue(data, namePtr, 'i32');
                  var funcPosition = FUNCTION_TABLE.push(func) - 1;
                  setValue(data + 4, funcPosition, 'i32');
                  setValue(data + 8, nargs, 'i16');
                  setValue(data + 12, flags, 'i16');
                  return data;
              },
              fromPtr: function(ptr) {
                  var namePtr = getValue(ptr, 'i32');
                  var name = Pointer_stringify(namePtr);
                  var func = FUNCTION_TABLE[getValue(ptr + 4, 'i32')]
                  return { name: name,
                           func: func,
                           nargs: getValue(ptr + 8, 'i16'),
                           flags: getValue(ptr + 12, 'i16') };
              },
          }
      },
   };


function start_jsjs() {
   var jsObjs = JSJS.Init();


   //Evaluate the script, which returns a JSVal
   var source = "(1 + 1)";
   var rval = JSJS.EvaluateScript(jsObjs.cx, jsObjs.glob, source);
   if (rval) {
       //Convert the JSVal to a double
       print('return value: '  + JSJS.ValueToNumber(jsObjs.cx, rval));
   } else {
       print("Can't get result because an error happened.")
   }
   
   // This is how you do a proper shut down
   JSJS.End(jsObjs);
}

<!-- window.onload = start_jsjs; -->

    </script>
  </head>
  <body>
    <h1>js.js Simple Execution Demo</h1>
    <p id="demo">Stuff Here.</p>
    <script type="text/javascript">
      var txt = "Normal javascript";
      document.getElementById("demo").innerHTML=txt;

      //      var src = "var myt = 'Changed by js.js'; document.getElementById('demo').innerHTML=myt";
      var src = "40 + 2";
      var jsObjs = JSJS.Init();
      
      /*
      
      This is an example of creating JSFunctionSpec
      
      function dummyFunc() {
          
      }
      var funcspecptr = JSJS.Types.JSFunctionSpec.makePtr("myfunc", dummyFunc, 0, 0);
      var typefromptr = JSJS.Types.JSFunctionSpec.fromPtr(funcspecptr);
      console.log(typefromptr);*/
      
      var rval = JSJS.EvaluateScript(jsObjs.cx, jsObjs.glob, src);
      var d;
      if (rval) {
          //Convert the JSVal to a double
          d = JSJS.ValueToNumber(jsObjs.cx, rval);
      } else {
          print("Can't get result because an error happened.")
      }

      document.getElementById("demo").innerHTML=d;

      // This is how you do a proper shut down
      JSJS.End(jsObjs);

    </script>
  </body>
</html>
