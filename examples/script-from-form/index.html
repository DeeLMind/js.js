<html>
<head>
  <script type="text/javascript" src="../../src/libjs.O2.js"></script>
  <script type="text/javascript" src="../../src/jsjs-wrapper.js"></script>
  <script type="text/javascript">
    function nativeForm()
    {
      console.log("Calling native form");
      var str = document.forms["myForm"]["str"].value;
      var resLoc = document.getElementById('res');
      var res = eval(str);      
      resLoc.innerHTML = res;
      return false;
    }


    function unprotectedForm()
    {
      console.log("Calling unprotected form");
      var jsObjs = JSJS.Init();
      var src = document.forms["myUnprotectedForm"]["upstr"].value;
      JSJS.InitDocument(jsObjs, 'unlocked');
      JSJS.InitWindow(jsObjs, 'unlocked');

      var rval = JSJS.EvaluateScript(jsObjs.cx, jsObjs.glob, src);
      var d;
      if (rval) {
          //Convert the JSVal 
          d = JSJS.identifyConvertValue(jsObjs.cx, rval);
      } else {
          d = "Can't get result because an error happened.";
      }

      var resLoc = document.getElementById('upres');
      resLoc.innerHTML = d;
      
      JSJS.End(jsObjs);


      return false;
    }


    function protectedForm()
    {
      console.log("Calling protected form");
      var jsObjs = JSJS.Init();
      var src = document.forms["myProtectedForm"]["pstr"].value;
      var rval = JSJS.EvaluateScript(jsObjs.cx, jsObjs.glob, src);
      var d;
      if (rval) {
          //Convert the JSVal 
          d = JSJS.identifyConvertValue(jsObjs.cx, rval);
      } else {
          d = "Can't get result because an error happened.";
      }

      var resLoc = document.getElementById('pres');
      resLoc.innerHTML = d;
      
      JSJS.End(jsObjs);
      return false;
    }

  </script>
</head>

<body>
  <form name="myForm" onsubmit="return nativeForm();" method="post">
    Native Input: <input type="text" name="str">
  <input type="submit" value="Submit">
  </form>


  <p></p>
  Results of native script: <p id="res"></p>
  <p id="extra"></p>


  <form name="myUnprotectedForm" onsubmit="return unprotectedForm();" method="post">
    Unprotected Input: <input type="text" name="upstr">
  <input type="submit" value="Submit">
  </form>

  <p></p>
  Results of unprotected script: <p id="upres"></p>
  <p id="upextra"></p>


  <form name="myProtectedForm" onsubmit="return protectedForm();" method="post">
    Protected Input: <input type="text" name="pstr">
  <input type="submit" value="Submit">
  </form>

  <p></p>
  Results of protected script: <p id="pres"></p>
  <p id="pextra"></p>
</body>

</html>
